"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var login=localStorage.getItem("login");login||(alert("还未登陆，请登录之后再来"),localStorage.setItem("url",location.href),location.href="./login.html");var car=function(){function a(t,e){_classCallCheck(this,a),this.ele=$(t),this.user=e,this.info={num:0,total:0},this.init()}return _createClass(a,[{key:"init",value:function(){var a=this;this.body=$(".panel-body"),this.num=$("#totalnumber"),this.types=$("#typegoods"),this.total=$(".setlement"),this.allcheck=$(".allcheck"),this.getData(),this.ele.click(function(t){var e=$(t.target);a.id=e.attr("idx"),e.hasClass("checked")&&(a.data.forEach(function(t){t.goods_id==a.id&&(t.checkit=e[0].checked)}),a.redenerTable()),e.hasClass("allcheck")&&(a.data.forEach(function(t){t.checkit=e[0].checked}),a.render()),e.hasClass("reduce")&&a.reduce(),e.hasClass("add")&&a.add(),e.hasClass("del")&&a.delect(a.id),e.hasClass("setlet")&&confirm("你确定要结算吗？")&&a.data.filter(function(t){return 1==t.checkit}).forEach(function(t){a.delect(t.goods_id)})})}},{key:"getData",value:async function(){var t=await $.pAjax({url:"../api/getcar.php",data:{username:this.user}});this.data=JSON.parse(t),this.render()}},{key:"render",value:function(){this.redenerTable();var a="";this.data.forEach(function(t){var e=t.goods_num*t.price;a+='<div class="media">\n               <div class="media-left">\n                   <a href="./details.html?='+t.goods_id+'" class="media_left">\n                       <input type="checkbox"  '+(t.checkit?"checked":"")+' class="checked" idx=\''+t.goods_id+'\'>\n                       <img class="media-object" style="width: 100px;"\n                           src="'+t.img+'"\n                           alt="...">\n                   </a>\n               </div>\n               <div class="media-body">\n                   <div class="media_body_left">\n                       <h4 class="media-heading">'+t.title+'</h4>\n                       <div class="price">\n                           <i class="glyphicon glyphicon-yen"></i>\n                           <span>'+t.price+'</span>\n                       </div>\n                   </div>\n                   <div class="media_body_center">\n                       <div class="btn-group" role="group" aria-label="...">\n                           <button type="button"  idx="'+t.goods_id+'" class="reduce btn btn-default">-</button>\n                           <button type="button" class="btn btn-default">'+t.goods_num+'</button>\n                           <button type="button"  idx="'+t.goods_id+'" class="add btn btn-default">+</button>\n                       </div>\n                   </div>\n                   <div class="media_body_right">\n                       <span>总价：￥'+e.toFixed(2)+'</span>\n                       <span idx="'+t.goods_id+'" class="glyphicon glyphicon-remove del"></span>\n                   </div>\n               </div>\n           </div>'}),this.body.html(a)}},{key:"redenerTable",value:function(){this.checkdata=this.data.filter(function(t){return 1==t.checkit}),this.info.num=this.checkdata.reduce(function(t,e){return t+ +e.goods_num},0),this.info.total=this.checkdata.reduce(function(t,e){return t+e.goods_num*e.price},0);var t=this.data.every(function(t){return 1==t.checkit});this.types.html(this.data.length),this.num.html(this.info.num),this.total.html("总价格：￥"+this.info.total),this.allcheck[0].checked=t}},{key:"reduce",value:function(){var e=this,a=this.data.find(function(t){return t.goods_id==e.id}).goods_num;a<=1?alert("商品数量最小为1!!!!"):$.ajax({url:"../api/revcar.php",data:{goods_id:this.id,goods_num:--a,username:this.user}}).then(function(t){(t=JSON.parse(t)).code&&e.data.forEach(function(t){t.goods_id==e.id&&(t.goods_num=a,e.render())})})}},{key:"add",value:function(){var e=this,a=this.data.find(function(t){return t.goods_id==e.id}).goods_num;$.ajax({url:"../api/revcar.php",data:{goods_id:this.id,goods_num:++a,username:this.user}}).then(function(t){(t=JSON.parse(t)).code&&e.data.forEach(function(t){t.goods_id==e.id&&(t.goods_num=a,e.render())})})}},{key:"delect",value:function(e){var a=this;$.ajax({url:"../api/revcar.php",data:{username:this.user,goods_id:e}}).then(function(t){(t=JSON.parse(t)).code&&(a.data=a.data.filter(function(t){return t.goods_id!=e}),a.render())})}}]),a}();new car(".container",login);